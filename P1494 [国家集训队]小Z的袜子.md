[题目传送门](https://www.luogu.com.cn/problem/P1494)

## 一、思路

题目要求里，“从该询问的区间 $[L,R]$ 中随机抽出两只袜子颜色相同的概率”，可以换一种说法：在静态区间 $[L,R]$ 中，**总共有多少个点对？有多少个两点相同的点对？** 

## 二、式子

对于问题 1 ，观察样例不难发现，区间内总共的点对数为 $\sum_{i=1}^{r-l}$ ,等差数列求和，即为 $(r-l+1)*(r-l)/2$ 。

对于问题 2 ，相似地，每种颜色内部构成的点对数为 $cnt_x*(cnt_x-1)/2$ 。而所有的颜色加起来，就是 $\sum_i cnt_x*(cnt_x-1)/2$ 。

最终的结果为两式相除。

## 三、代码

核心部分 `add()` 和 `del()` 函数，写了几遍都嫌太麻烦。最后发现，对于每一次移位，不需要考虑详细的贡献，直接**一减一加**就解决了。

```cpp
inline void add(const int &x){
	maxx-=cnt[x]*(cnt[x]-1)/2;
	++cnt[x];
	maxx+=cnt[x]*(cnt[x]-1)/2;
}
inline void del(const int &x){
	maxx-=cnt[x]*(cnt[x]-1)/2;
	--cnt[x];
	maxx+=cnt[x]*(cnt[x]-1)/2;
}
```

注意事项：**第一次按照左端点排序，第二次分奇偶性排序！**